##On the Wazuh Server (Manager):

#Create a CDB List:
#Create a CDB list file named malware-hashes and save it in the /var/ossec/etc/lists directory on the Wazuh server.

nano /var/ossec/etc/lists/malware-hashes

#Add Known Malware Hashes:
#In the malware-hashes file, add known malware hashes as key:value pairs. For example, you can use the known MD5 hashes of the Mirai and Xbash malware:

e0ec2cd43f71c80d42cd7b0f17802c73:mirai
55142f1d393c5ba7405239f232a6c059:Xbash

#Reference the CDB List:
#Edit the Wazuh manager configuration file /var/ossec/etc/ossec.conf to reference the CDB list. Add the following line within the <ruleset> block:

<list>etc/lists/malware-hashes</list>

#Example:

<ruleset>
   <!-- Default ruleset -->
   <decoder_dir>ruleset/decoders</decoder_dir>
   <rule_dir>ruleset/rules</rule_dir>
   <rule_exclude>0215-policy_rules.xml</rule_exclude>
   <list>etc/lists/audit-keys</list>
   <list>etc/lists/amazon/aws-eventnames</list>
   <list>etc/lists/security-eventchannel</list>
   <list>etc/lists/malware-hashes</list>
</ruleset>

#Create a Custom Rule:
#Create a custom rule in the /var/ossec/etc/rules/local_rules.xml file on the Wazuh server. This rule will generate alerts when the Wazuh analysis engine matches the MD5 hash of a new or modified file to a hash in the CDB list. Make sure that rules 554 and 550 have previously matched, indicating a recently created or modified file.

<group name="malware,">
  <rule id="110002" level="13">
    <!-- The if_sid tag references the built-in FIM rules -->
    <if_sid>554, 550</if_sid>
    <list field="md5" lookup="match_key">etc/lists/malware-hashes</list>
    <description>File with known malware hash detected: $(file)</description>
    <mitre>
      <id>T1204.002</id>
    </mitre>
  </rule>
</group>

#Restart the Wazuh Manager:
#Apply the changes by restarting the Wazuh manager:

systemctl restart wazuh-manager

#On the Linux Endpoint:

#Configure Directory Monitoring:
#Configure directory monitoring on the Linux endpoint by adding the <directories> block specifying the folders you want to monitor in the agent configuration file (/var/ossec/etc/ossec.conf) or using centralized configuration.
#Example:

<ossec_config>
  <syscheck>
    <disabled>no</disabled>
    <directories check_all="yes" realtime="yes">/PATH/TO/MONITORED/DIRECTORY</directories>
  </syscheck>
</ossec_config>

#The check_all="yes" option ensures Wazuh checks all file attributes including file size, permissions, owner, last modification date, inode, and the hash sums.

#Restart the Wazuh Agent:
#Apply the changes to the agent configuration by restarting the Wazuh agent:

systemctl restart wazuh-agent
